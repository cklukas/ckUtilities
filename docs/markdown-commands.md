# ck-edit Markdown Command Behaviors

This guide summarizes how each Markdown-aware command in `ck-edit` manipulates the
buffer, including cursor placement and selection handling. It focuses on commands that
insert, wrap, or otherwise rewrite Markdown content so you rarely need to adjust the
caret manually after using the menu actions.

## Command behavior definitions

Inline formatting commands share a common specification. The
`InlineCommandSpec` structure captures the command name, marker text, placeholder
content, cursor placement rules, and whether selections should be preserved for the
inner content.【F:src/tools/ck-edit/include/ck/edit/markdown_editor.hpp†L175-L193】 The
editor registers the built-in specs for bold, italic, combined emphasis, strikethrough,
and inline code in a central lookup table so the same behavior applies everywhere the
command is invoked.【F:src/tools/ck-edit/src/markdown_editor.cpp†L153-L164】 The
`applyInlineCommand` helper wraps or unwraps the active selection using that spec,
falls back to inserting prefix/suffix pairs when nothing is selected, and positions the
caret according to the requested cursor placement. It also preserves the selection on
the inner text when wrapping existing content.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1158-L1241】

Block-oriented commands operate on the current selection of lines (or the line under the
cursor when nothing is selected) via `captureSelectedLines`, then call
`applyBlockSelection` to rewrite the text. This routine replaces the marked range and
leaves the caret immediately after the inserted block with no active selection, because
`replaceRange` moves the cursor to the end of the new text.【F:src/tools/ck-edit/src/markdown_editor.cpp†L978-L993】【F:src/tools/ck-edit/src/markdown_editor.cpp†L3104-L3110】

The tables below group commands by purpose and describe their behavior in Markdown mode.

## Inline formatting commands

| Command | Selection behavior | No selection | Caret after | Selection after |
| --- | --- | --- | --- | --- |
| Bold | Wraps the selection with `**` (or removes surrounding `**` markers) and keeps the inner text selected for continued editing.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1158-L1199】【F:src/tools/ck-edit/src/markdown_editor.cpp†L153-L156】 | Inserts `****` and leaves the caret between the two pairs so typing continues inside the emphasis span.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1209-L1239】【F:src/tools/ck-edit/src/markdown_editor.cpp†L153-L156】 | At the end of the opening markers (`CursorPlacement::AfterPrefix`).【F:src/tools/ck-edit/src/markdown_editor.cpp†L1223-L1235】 | Inner text remains selected when wrapping; otherwise the selection is cleared.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1193-L1199】【F:src/tools/ck-edit/src/markdown_editor.cpp†L1237-L1239】 |
| Italic | Uses single `*` markers with the same wrap/remove behavior and inner selection preservation as bold.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1158-L1199】【F:src/tools/ck-edit/src/markdown_editor.cpp†L156-L158】 | Inserts `**` and positions the caret after the opening `*`.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1209-L1239】【F:src/tools/ck-edit/src/markdown_editor.cpp†L156-L158】 | After the opening marker.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1223-L1235】 | Same as bold.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1193-L1199】 |
| Bold + Italic | Wraps or unwraps with triple markers (`***`) while keeping the inner text selected.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1158-L1199】【F:src/tools/ck-edit/src/markdown_editor.cpp†L158-L160】 | Inserts six asterisks and leaves the caret between the first and second group.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1209-L1239】【F:src/tools/ck-edit/src/markdown_editor.cpp†L158-L160】 | After the opening triple marker.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1223-L1235】 | Same as bold.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1193-L1199】 |
| Strikethrough | Wraps or removes `~~` markers and keeps the wrapped text selected.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1158-L1199】【F:src/tools/ck-edit/src/markdown_editor.cpp†L160-L163】 | Inserts `~~~~` and positions the caret inside the pair.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1209-L1239】【F:src/tools/ck-edit/src/markdown_editor.cpp†L160-L163】 | After the opening tildes.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1223-L1235】 | Same as bold.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1193-L1199】 |
| Inline code | Removes matching backtick fences around the selection when present, or adds a fence long enough to contain any nested backticks while keeping only the inner text selected.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1302-L1362】 | Inserts `` `` `` for a blank code span and places the caret between the ticks for immediate typing.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1304-L1309】 | Inside the code span after the opening fence.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1304-L1362】 | Inner text stays selected after wrapping; selection clears when no text existed.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1330-L1361】 |
| Remove formatting | Expands the selection to the nearest word when needed, strips matching emphasis markers or code fences, and selects the unformatted text so it can be edited further.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1657-L1664】【F:src/tools/ck-edit/src/markdown_editor.cpp†L1244-L1279】 | No effect when nothing can be selected automatically.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1657-L1664】 | At the start of the cleaned span (Turbo Vision default after `replaceRange`).【F:src/tools/ck-edit/src/markdown_editor.cpp†L1244-L1279】【F:src/tools/ck-edit/src/markdown_editor.cpp†L3104-L3110】 | Cleaned text remains selected.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1255-L1277】 |

## Block-level commands

| Command | Selection behavior | No selection | Caret after | Selection after |
| --- | --- | --- | --- | --- |
| Heading 1–6 | Converts each selected line to the requested ATX heading level, replacing existing markers and retaining indentation.【F:src/tools/ck-edit/src/markdown_editor.cpp†L872-L907】 | Operates on the current line because `captureSelectedLines` includes it when nothing is selected.【F:src/tools/ck-edit/src/markdown_editor.cpp†L906-L940】 | After the rewritten heading block via `applyBlockSelection`/`replaceRange`.【F:src/tools/ck-edit/src/markdown_editor.cpp†L978-L993】【F:src/tools/ck-edit/src/markdown_editor.cpp†L3104-L3110】 | Selection cleared after rewrite (Turbo Vision default).【F:src/tools/ck-edit/src/markdown_editor.cpp†L978-L993】 |
| Clear heading | Removes heading markers from each selected line while preserving indentation.【F:src/tools/ck-edit/src/markdown_editor.cpp†L909-L933】 | Acts on the current line when nothing is selected.【F:src/tools/ck-edit/src/markdown_editor.cpp†L906-L940】 | After the cleaned block.【F:src/tools/ck-edit/src/markdown_editor.cpp†L978-L993】【F:src/tools/ck-edit/src/markdown_editor.cpp†L3104-L3110】 | Selection cleared.【F:src/tools/ck-edit/src/markdown_editor.cpp†L978-L993】 |
| Make paragraph | Trims the selection to paragraphs and ensures blank lines surround the content before re-inserting it.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1338-L1405】 | Uses the current paragraph when nothing is selected.【F:src/tools/ck-edit/src/markdown_editor.cpp†L906-L940】 | After the reformatted block.【F:src/tools/ck-edit/src/markdown_editor.cpp†L978-L993】【F:src/tools/ck-edit/src/markdown_editor.cpp†L3104-L3110】 | Selection cleared.【F:src/tools/ck-edit/src/markdown_editor.cpp†L978-L993】 |
| Toggle blockquote | Adds or removes `>` prefixes for each selected line, preserving indentation and skipping blank lines.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1474-L1509】 | Current line is treated as the selection when none is active.【F:src/tools/ck-edit/src/markdown_editor.cpp†L906-L940】 | After the modified block.【F:src/tools/ck-edit/src/markdown_editor.cpp†L978-L993】【F:src/tools/ck-edit/src/markdown_editor.cpp†L3104-L3110】 | Selection cleared.【F:src/tools/ck-edit/src/markdown_editor.cpp†L978-L993】 |
| Increase indent | Inserts two spaces at the start of each selected line.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1601-L1607】 | Current line indented when no selection.【F:src/tools/ck-edit/src/markdown_editor.cpp†L906-L940】 | After block replacement.【F:src/tools/ck-edit/src/markdown_editor.cpp†L978-L993】【F:src/tools/ck-edit/src/markdown_editor.cpp†L3104-L3110】 | Selection cleared.【F:src/tools/ck-edit/src/markdown_editor.cpp†L978-L993】 |
| Decrease indent | Removes up to two leading spaces or a tab from each selected line.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1610-L1623】 | Works on current line when no selection.【F:src/tools/ck-edit/src/markdown_editor.cpp†L906-L940】 | After block replacement.【F:src/tools/ck-edit/src/markdown_editor.cpp†L978-L993】【F:src/tools/ck-edit/src/markdown_editor.cpp†L3104-L3110】 | Selection cleared.【F:src/tools/ck-edit/src/markdown_editor.cpp†L978-L993】 |
| Definition list | Splits each selected `term: definition` line into a two-line definition list entry, duplicating blank lines when needed.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1626-L1654】 | Applies to current line when nothing is selected.【F:src/tools/ck-edit/src/markdown_editor.cpp†L906-L940】 | After rewritten block.【F:src/tools/ck-edit/src/markdown_editor.cpp†L978-L993】【F:src/tools/ck-edit/src/markdown_editor.cpp†L3104-L3110】 | Selection cleared.【F:src/tools/ck-edit/src/markdown_editor.cpp†L978-L993】 |
| Toggle code block | Adds or removes triple backtick fences around the selected block, trimming surrounding blank lines first.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1365-L1421】 | Operates on the current line block when no selection.【F:src/tools/ck-edit/src/markdown_editor.cpp†L906-L940】 | After the fenced block.【F:src/tools/ck-edit/src/markdown_editor.cpp†L978-L993】【F:src/tools/ck-edit/src/markdown_editor.cpp†L3104-L3110】 | Selection cleared.【F:src/tools/ck-edit/src/markdown_editor.cpp†L978-L993】 |
| Insert line break | Inserts two trailing spaces plus a newline to force a Markdown line break.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1465-L1473】 | Same behavior because the command is point-based.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1465-L1473】 | Caret after the inserted newline (Turbo Vision insert behavior).【F:src/tools/ck-edit/src/markdown_editor.cpp†L1465-L1473】【F:src/tools/ck-edit/src/markdown_editor.cpp†L3104-L3110】 | Selection cleared.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1465-L1473】 |
| Toggle task checkbox | Flips the `[ ]` or `[x]` marker on the current task list item, leaving other text unchanged.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1565-L1598】 | Always targets the line under the cursor.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1565-L1598】 | Caret ends at the end of the rewritten line.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1595-L1598】【F:src/tools/ck-edit/src/markdown_editor.cpp†L3104-L3110】 | No selection remains.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1565-L1598】 |

## List manipulation commands

| Command | Selection behavior | No selection | Caret after | Selection after |
| --- | --- | --- | --- | --- |
| Bulleted list | Forces each selected line into `-` bullet form using the existing indentation and blockquote prefix.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1512-L1525】 | Current line toggled when nothing is selected.【F:src/tools/ck-edit/src/markdown_editor.cpp†L906-L940】 | After rewritten block (`applyBlockSelection`).【F:src/tools/ck-edit/src/markdown_editor.cpp†L978-L993】【F:src/tools/ck-edit/src/markdown_editor.cpp†L3104-L3110】 | Selection cleared.【F:src/tools/ck-edit/src/markdown_editor.cpp†L978-L993】 |
| Numbered list | Rewrites each selected line as `1.` list items, keeping indentation and blockquotes.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1527-L1540】 | Current line handled when no selection.【F:src/tools/ck-edit/src/markdown_editor.cpp†L906-L940】 | After rewritten block.【F:src/tools/ck-edit/src/markdown_editor.cpp†L978-L993】【F:src/tools/ck-edit/src/markdown_editor.cpp†L3104-L3110】 | Selection cleared.【F:src/tools/ck-edit/src/markdown_editor.cpp†L978-L993】 |
| Task list | Converts each selected line to `- [ ]` or preserves `[x]` if already checked, keeping indentation/blockquote context.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1542-L1563】 | Current line converted when none selected.【F:src/tools/ck-edit/src/markdown_editor.cpp†L906-L940】 | After rewritten block.【F:src/tools/ck-edit/src/markdown_editor.cpp†L978-L993】【F:src/tools/ck-edit/src/markdown_editor.cpp†L3104-L3110】 | Selection cleared.【F:src/tools/ck-edit/src/markdown_editor.cpp†L978-L993】 |
| Auto list continuation | Toggles the editor flag that continues list markers when pressing Enter; it does not modify text immediately.【F:src/tools/ck-edit/src/markdown_editor.cpp†L2525-L2528】 | N/A | Caret unchanged.【F:src/tools/ck-edit/src/markdown_editor.cpp†L2525-L2528】 | Selection unchanged.【F:src/tools/ck-edit/src/markdown_editor.cpp†L2525-L2528】 |
| Insert sample bullet list | Prompts for a count and inserts template bullet items using `insertRichInline`, leaving the caret at the end of the inserted block.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1724-L1744】【F:src/tools/ck-edit/src/markdown_editor.cpp†L1751-L1762】 | Same behavior. | At end of inserted placeholder block.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1751-L1762】 | Selection cleared.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1751-L1762】 |
| Insert sample numbered list | Same as above but with numbered markers.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1724-L1749】【F:src/tools/ck-edit/src/markdown_editor.cpp†L1751-L1762】 | Same. | At end of inserted block.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1751-L1762】 | Selection cleared.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1751-L1762】 |

## Insert, link, and media commands

| Command | Selection behavior | No selection | Caret after | Selection after |
| --- | --- | --- | --- | --- |
| Insert/Edit link | Prompts for link text (prefilling the selection) and target, then inserts `[label](url)` at the caret via `insertRichInline`, leaving the caret after the inserted link.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1808-L1819】【F:src/tools/ck-edit/src/markdown_editor.cpp†L1751-L1762】 | Same prompt sequence with empty default label. | At end of inserted link.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1751-L1762】 | Selection cleared.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1751-L1762】 |
| Reference link | Uses the selection or prompted text to insert `[label][id]`, then appends a definition at the document end. The caret stays after the inline reference text.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1834-L1872】 | Same prompt flow when no selection. | After the inserted reference text.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1860-L1866】 | Selection cleared.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1860-L1866】 |
| Auto-link selection | Expands to the nearest word if needed, wraps recognized URLs or emails in `<…>`, or removes angle brackets when already present. The transformed text remains selected for further editing.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1875-L1912】 | No effect without a selectable token.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1875-L1883】 | At end of replaced span.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1907-L1912】【F:src/tools/ck-edit/src/markdown_editor.cpp†L3104-L3110】 | New text stays selected.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1907-L1912】 |
| Insert image | Prompts for alt text and URL, inserts the Markdown image syntax via `insertRichInline`, and leaves the caret after the snippet.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1821-L1832】【F:src/tools/ck-edit/src/markdown_editor.cpp†L1751-L1762】 | Same behavior. | At end of inserted image markup.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1751-L1762】 | Selection cleared.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1751-L1762】 |
| Insert footnote | Inserts a footnote marker at the caret (removing the selection first) and appends a definition stub at the end of the document.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1915-L1933】 | Same behavior. | After the inserted marker.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1924-L1929】 | Selection cleared.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1924-L1929】 |
| Horizontal rule | Inserts a blank line if needed, adds `---` with trailing newline(s), and leaves the caret after the rule block.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1936-L1948】 | Same. | After the inserted block.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1936-L1948】【F:src/tools/ck-edit/src/markdown_editor.cpp†L3104-L3110】 | Selection cleared.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1936-L1948】 |
| Escape selection | Escapes Markdown special characters in the selection and keeps the escaped text selected.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1951-L1972】 | No effect without a selection.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1951-L1956】 | After the escaped span.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1968-L1972】【F:src/tools/ck-edit/src/markdown_editor.cpp†L3104-L3110】 | Escaped text stays selected.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1968-L1972】 |

## Table commands

| Command | Selection behavior | No selection | Caret after | Selection after |
| --- | --- | --- | --- | --- |
| Insert table | Prompts for dimensions and inserts a header/separator/body template at the caret using `insertRichInline`, including leading/trailing blank lines if needed.【F:src/tools/ck-edit/src/markdown_editor.cpp†L2086-L2128】【F:src/tools/ck-edit/src/markdown_editor.cpp†L1751-L1762】 | Same behavior. | At end of inserted table template.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1751-L1762】 | Selection cleared.【F:src/tools/ck-edit/src/markdown_editor.cpp†L1751-L1762】 |
| Insert row above/below | Locates the current table, rebuilds the Markdown rows with a new empty row above or below, and rewrites the entire table block via `replaceRange`. The caret moves to the inserted row.【F:src/tools/ck-edit/src/markdown_editor.cpp†L2130-L2248】 | Requires the caret to be inside a table; otherwise no change.【F:src/tools/ck-edit/src/markdown_editor.cpp†L2130-L2146】 | At the start of the affected row after reconstruction.【F:src/tools/ck-edit/src/markdown_editor.cpp†L2218-L2248】【F:src/tools/ck-edit/src/markdown_editor.cpp†L3104-L3110】 | Selection cleared. |
| Delete row | Rebuilds the table without the active body row, then rewrites the block and places the caret on the nearest remaining row.【F:src/tools/ck-edit/src/markdown_editor.cpp†L2164-L2234】 | N/A | On the row chosen after deletion.【F:src/tools/ck-edit/src/markdown_editor.cpp†L2234-L2247】 | Selection cleared. |
| Insert column before/after | Reconstructs the table with a new empty column at the requested position and rewrites the table block, keeping the caret on the same logical row.【F:src/tools/ck-edit/src/markdown_editor.cpp†L2260-L2334】【F:src/tools/ck-edit/src/markdown_editor.cpp†L2680-L2730】 | N/A | On the row containing the caret after rewrite.【F:src/tools/ck-edit/src/markdown_editor.cpp†L2724-L2732】 | Selection cleared. |
| Delete column | Removes the active column after confirmation, rewrites the table block, and keeps the caret on the corresponding row.【F:src/tools/ck-edit/src/markdown_editor.cpp†L2260-L2334】 | N/A | On the adjusted row.【F:src/tools/ck-edit/src/markdown_editor.cpp†L2320-L2334】 | Selection cleared. |
| Align column (default/left/center/right/number) | Updates the separator line for the active column to the requested alignment marker, rewrites the table block, and keeps the caret on the same header/separator/body row.【F:src/tools/ck-edit/src/markdown_editor.cpp†L2386-L2848】 | N/A | On the row that contained the caret before the alignment change.【F:src/tools/ck-edit/src/markdown_editor.cpp†L2778-L2843】 | Selection cleared. |
| Delete table | Removes the entire table block and leaves the caret where the table started.【F:src/tools/ck-edit/src/markdown_editor.cpp†L2360-L2384】 | N/A | At the former table start.【F:src/tools/ck-edit/src/markdown_editor.cpp†L2360-L2384】【F:src/tools/ck-edit/src/markdown_editor.cpp†L3104-L3110】 | Selection cleared. |

## Document formatting commands

| Command | Selection behavior | No selection | Caret after | Selection after |
| --- | --- | --- | --- | --- |
| Reflow paragraphs | Rewraps the selected paragraphs to even line widths, preserving blank-line separators, and replaces the selection with the result.【F:src/tools/ck-edit/src/markdown_editor.cpp†L2394-L2477】 | No effect without a selection.【F:src/tools/ck-edit/src/markdown_editor.cpp†L2394-L2403】 | After the reflowed text.【F:src/tools/ck-edit/src/markdown_editor.cpp†L2465-L2477】【F:src/tools/ck-edit/src/markdown_editor.cpp†L3104-L3110】 | Selection cleared.【F:src/tools/ck-edit/src/markdown_editor.cpp†L2465-L2477】 |
| Format document | Replaces the entire buffer with the formatter output, preserving the caret at the buffer start afterward.【F:src/tools/ck-edit/src/markdown_editor.cpp†L2479-L2524】 | Always processes the full document. | Caret at start (formatter rewrites entire buffer via `replaceRange`).【F:src/tools/ck-edit/src/markdown_editor.cpp†L2494-L2524】【F:src/tools/ck-edit/src/markdown_editor.cpp†L3104-L3110】 | Selection cleared. |
| Toggle smart list continuation | Toggles the internal flag that continues list markers when pressing Enter; does not modify existing text.【F:src/tools/ck-edit/src/markdown_editor.cpp†L2525-L2533】 | N/A | Caret unchanged.【F:src/tools/ck-edit/src/markdown_editor.cpp†L2525-L2533】 | Selection unchanged.【F:src/tools/ck-edit/src/markdown_editor.cpp†L2525-L2533】 |

These definitions ensure every formatting command now has predictable cursor and
selection handling, matching the shared specifications or the documented block rewrite
behavior.
